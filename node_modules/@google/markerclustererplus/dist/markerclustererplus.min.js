var MarkerClusterer=function(){"use strict";class t{constructor(e,s){e.getMarkerClusterer().extend(t,google.maps.OverlayView),this.cluster_=e,this.className_=e.getMarkerClusterer().getClusterClass(),this.styles_=s,this.center_=null,this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(e.getMap())}onAdd(){var t,e,s=this,i=google.maps.version.split(".");i=parseInt(100*i[0],10)+parseInt(i[1],10),this.div_=document.createElement("div"),this.div_.className=this.className_,this.visible_&&this.show(),this.getPanes().overlayMouseTarget.appendChild(this.div_),this.boundsChangedListener_=google.maps.event.addListener(this.getMap(),"bounds_changed",(function(){e=t})),google.maps.event.addDomListener(this.div_,"mousedown",(function(){t=!0,e=!1})),i>=332&&google.maps.event.addDomListener(this.div_,"touchstart",(function(t){t.stopPropagation()})),google.maps.event.addDomListener(this.div_,"click",(function(i){if(t=!1,!e){var r,a,n=s.cluster_.getMarkerClusterer();google.maps.event.trigger(n,"click",s.cluster_),google.maps.event.trigger(n,"clusterclick",s.cluster_),n.getZoomOnClick()&&(a=n.getMaxZoom(),r=s.cluster_.getBounds(),n.getMap().fitBounds(r),setTimeout((function(){n.getMap().fitBounds(r),null!==a&&n.getMap().getZoom()>a&&n.getMap().setZoom(a+1)}),100)),i.cancelBubble=!0,i.stopPropagation&&i.stopPropagation()}})),google.maps.event.addDomListener(this.div_,"mouseover",(function(){var t=s.cluster_.getMarkerClusterer();google.maps.event.trigger(t,"mouseover",s.cluster_)})),google.maps.event.addDomListener(this.div_,"mouseout",(function(){var t=s.cluster_.getMarkerClusterer();google.maps.event.trigger(t,"mouseout",s.cluster_)}))}onRemove(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.removeListener(this.boundsChangedListener_),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)}draw(){if(this.visible_){var t=this.getPosFromLatLng_(this.center_);this.div_.style.top=t.y+"px",this.div_.style.left=t.x+"px",this.div_.style.zIndex=google.maps.Marker.MAX_ZINDEX+1}}hide(){this.div_&&(this.div_.style.display="none"),this.visible_=!1}show(){if(this.div_){var t=this.cluster_.markerClusterer_.ariaLabelFn(this.sums_.text),e="",s=this.backgroundPosition_.split(" "),i=parseInt(s[0].replace(/^\s+|\s+$/g,""),10),r=parseInt(s[1].replace(/^\s+|\s+$/g,""),10),a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a),e="<img aria-hidden='true' src='"+this.url_+"' style='position: absolute; top: "+r+"px; left: "+i+"px; ",this.cluster_.getMarkerClusterer().enableRetinaIcons_?e+="width: "+this.width_+"px; height: "+this.height_+"px;":e+="clip: rect("+-1*r+"px, "+(-1*i+this.width_)+"px, "+(-1*r+this.height_)+"px, "+-1*i+"px);",e+="'>",this.div_.innerHTML=e+"<div aria-label='"+t+"' tabindex='0' style='position: absolute;top: "+this.anchorText_[0]+"px;left: "+this.anchorText_[1]+"px;color: "+this.textColor_+";font-size: "+this.textSize_+"px;font-family: "+this.fontFamily_+";font-weight: "+this.fontWeight_+";font-style: "+this.fontStyle_+";text-decoration: "+this.textDecoration_+";text-align: center;width: "+this.width_+"px;line-height:"+this.height_+"px;'><span aria-hidden='true'>"+this.sums_.text+"</span></div>",void 0===this.sums_.title||""===this.sums_.title?this.div_.title=this.cluster_.getMarkerClusterer().getTitle():this.div_.title=this.sums_.title,this.div_.style.display=""}this.visible_=!0}useStyle(t){this.sums_=t;var e=Math.max(0,t.index-1);e=Math.min(this.styles_.length-1,e);var s=this.styles_[e];this.url_=s.url,this.height_=s.height,this.width_=s.width,this.anchorText_=s.anchorText||[0,0],this.anchorIcon_=s.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)],this.textColor_=s.textColor||"black",this.textSize_=s.textSize||11,this.textDecoration_=s.textDecoration||"none",this.fontWeight_=s.fontWeight||"bold",this.fontStyle_=s.fontStyle||"normal",this.fontFamily_=s.fontFamily||"Arial,sans-serif",this.backgroundPosition_=s.backgroundPosition||"0 0"}setCenter(t){this.center_=t}createCss(t){var e=[];return e.push("cursor: pointer;"),e.push("position: absolute; top: "+t.y+"px; left: "+t.x+"px;"),e.push("width: "+this.width_+"px; height: "+this.height_+"px;"),e.push("-webkit-user-select: none;"),e.push("-khtml-user-select: none;"),e.push("-moz-user-select: none;"),e.push("-o-user-select: none;"),e.push("user-select: none;"),e.join("")}getPosFromLatLng_(t){var e=this.getProjection().fromLatLngToDivPixel(t);return e.x-=this.anchorIcon_[1],e.y-=this.anchorIcon_[0],e.x=parseInt(e.x,10),e.y=parseInt(e.y,10),e}}class e{constructor(e){this.markerClusterer_=e,this.map_=e.getMap(),this.gridSize_=e.getGridSize(),this.minClusterSize_=e.getMinimumClusterSize(),this.averageCenter_=e.getAverageCenter(),this.markers_=[],this.center_=null,this.bounds_=null,this.clusterIcon_=new t(this,e.getStyles())}getSize(){return this.markers_.length}getMarkers(){return this.markers_}getCenter(){return this.center_}getMap(){return this.map_}getMarkerClusterer(){return this.markerClusterer_}getBounds(){var t,e=new google.maps.LatLngBounds(this.center_,this.center_),s=this.getMarkers();for(t=0;t<s.length;t++)e.extend(s[t].getPosition());return e}remove(){this.clusterIcon_.setMap(null),this.markers_=[],delete this.markers_}addMarker(t){var e,s,i;if(this.isMarkerAlreadyAdded_(t))return!1;if(this.center_){if(this.averageCenter_){var r=this.markers_.length+1,a=(this.center_.lat()*(r-1)+t.getPosition().lat())/r,n=(this.center_.lng()*(r-1)+t.getPosition().lng())/r;this.center_=new google.maps.LatLng(a,n),this.calculateBounds_()}}else this.center_=t.getPosition(),this.calculateBounds_();if(t.isAdded=!0,this.markers_.push(t),s=this.markers_.length,null!==(i=this.markerClusterer_.getMaxZoom())&&this.map_.getZoom()>i)t.getMap()!==this.map_&&t.setMap(this.map_);else if(s<this.minClusterSize_)t.getMap()!==this.map_&&t.setMap(this.map_);else if(s===this.minClusterSize_)for(e=0;e<s;e++)this.markers_[e].setMap(null);else t.setMap(null);return this.updateIcon_(),!0}isMarkerInClusterBounds(t){return this.bounds_.contains(t.getPosition())}calculateBounds_(){var t=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(t)}updateIcon_(){var t=this.markers_.length,e=this.markerClusterer_.getMaxZoom();if(null!==e&&this.map_.getZoom()>e)this.clusterIcon_.hide();else if(t<this.minClusterSize_)this.clusterIcon_.hide();else{var s=this.markerClusterer_.getStyles().length,i=this.markerClusterer_.getCalculator()(this.markers_,s);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(i),this.clusterIcon_.show()}}isMarkerAlreadyAdded_(t){var e;if(this.markers_.indexOf)return-1!==this.markers_.indexOf(t);for(e=0;e<this.markers_.length;e++)if(t===this.markers_[e])return!0;return!1}}class s{constructor(t,e,i){this.extend(s,google.maps.OverlayView),e=e||[],i=i||{},this.BATCH_SIZE=2e3,this.BATCH_SIZE_IE=500,this.IMAGE_PATH="../images/m",this.IMAGE_EXTENSION="png",this.IMAGE_SIZES=[53,56,66,78,90],this.markers_=[],this.clusters_=[],this.listeners_=[],this.activeMap_=null,this.ready_=!1,this.ariaLabelFn=i.ariaLabelFn||function(){return""},this.gridSize_=i.gridSize||60,this.minClusterSize_=i.minimumClusterSize||2,this.maxZoom_=i.maxZoom||null,this.styles_=i.styles||[],this.title_=i.title||"",this.zoomOnClick_=!0,void 0!==i.zoomOnClick&&(this.zoomOnClick_=i.zoomOnClick),this.averageCenter_=!1,void 0!==i.averageCenter&&(this.averageCenter_=i.averageCenter),this.ignoreHidden_=!1,void 0!==i.ignoreHidden&&(this.ignoreHidden_=i.ignoreHidden),this.enableRetinaIcons_=!1,void 0!==i.enableRetinaIcons&&(this.enableRetinaIcons_=i.enableRetinaIcons),this.imagePath_=i.imagePath||this.IMAGE_PATH,this.imageExtension_=i.imageExtension||this.IMAGE_EXTENSION,this.imageSizes_=i.imageSizes||this.IMAGE_SIZES,this.calculator_=i.calculator||this.CALCULATOR,this.batchSize_=i.batchSize||this.BATCH_SIZE,this.batchSizeIE_=i.batchSizeIE||this.BATCH_SIZE_IE,this.clusterClass_=i.clusterClass||"cluster",-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize_=this.batchSizeIE_),this.setupStyles_(),this.addMarkers(e,!0),this.setMap(t)}onAdd(){var t=this;this.activeMap_=this.getMap(),this.ready_=!0,this.repaint(),this.prevZoom_=this.getMap().getZoom(),this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",function(){var t=this.getMap().getZoom(),e=this.getMap().minZoom||0,s=Math.min(this.getMap().maxZoom||100,this.getMap().mapTypes[this.getMap().getMapTypeId()].maxZoom);t=Math.min(Math.max(t,e),s),this.prevZoom_!=t&&(this.prevZoom_=t,this.resetViewport_(!1))}.bind(this)),google.maps.event.addListener(this.getMap(),"idle",(function(){t.redraw_()}))]}onRemove(){var t;for(t=0;t<this.markers_.length;t++)this.markers_[t].getMap()!==this.activeMap_&&this.markers_[t].setMap(this.activeMap_);for(t=0;t<this.clusters_.length;t++)this.clusters_[t].remove();for(this.clusters_=[],t=0;t<this.listeners_.length;t++)google.maps.event.removeListener(this.listeners_[t]);this.listeners_=[],this.activeMap_=null,this.ready_=!1}draw(){}setupStyles_(){var t,e;if(!(this.styles_.length>0))for(t=0;t<this.imageSizes_.length;t++)e=this.imageSizes_[t],this.styles_.push({url:this.imagePath_+(t+1)+"."+this.imageExtension_,height:e,width:e})}fitMapToMarkers(){var t,e=this.getMarkers(),s=new google.maps.LatLngBounds;for(t=0;t<e.length;t++)!e[t].getVisible()&&this.getIgnoreHidden()||s.extend(e[t].getPosition());this.getMap().fitBounds(s)}getGridSize(){return this.gridSize_}setGridSize(t){this.gridSize_=t}getMinimumClusterSize(){return this.minClusterSize_}setMinimumClusterSize(t){this.minClusterSize_=t}getMaxZoom(){return this.maxZoom_}setMaxZoom(t){this.maxZoom_=t}getStyles(){return this.styles_}setStyles(t){this.styles_=t}getTitle(){return this.title_}setTitle(t){this.title_=t}getZoomOnClick(){return this.zoomOnClick_}setZoomOnClick(t){this.zoomOnClick_=t}getAverageCenter(){return this.averageCenter_}setAverageCenter(t){this.averageCenter_=t}getIgnoreHidden(){return this.ignoreHidden_}setIgnoreHidden(t){this.ignoreHidden_=t}getEnableRetinaIcons(){return this.enableRetinaIcons_}setEnableRetinaIcons(t){this.enableRetinaIcons_=t}getImageExtension(){return this.imageExtension_}setImageExtension(t){this.imageExtension_=t}getImagePath(){return this.imagePath_}setImagePath(t){this.imagePath_=t}getImageSizes(){return this.imageSizes_}setImageSizes(t){this.imageSizes_=t}getCalculator(){return this.calculator_}setCalculator(t){this.calculator_=t}getBatchSizeIE(){return this.batchSizeIE_}setBatchSizeIE(t){this.batchSizeIE_=t}getClusterClass(){return this.clusterClass_}setClusterClass(t){this.clusterClass_=t}getMarkers(){return this.markers_}getTotalMarkers(){return this.markers_.length}getClusters(){return this.clusters_}getTotalClusters(){return this.clusters_.length}addMarker(t,e){this.pushMarkerTo_(t),e||this.redraw_()}addMarkers(t,e){var s;for(s in t)t.hasOwnProperty(s)&&this.pushMarkerTo_(t[s]);e||this.redraw_()}pushMarkerTo_(t){if(t.getDraggable()){var e=this;google.maps.event.addListener(t,"dragend",(function(){e.ready_&&(this.isAdded=!1,e.repaint())}))}t.isAdded=!1,this.markers_.push(t)}removeMarker(t,e){var s=this.removeMarker_(t);return!e&&s&&this.repaint(),s}removeMarkers(t,e){var s,i,r=!1;for(s=0;s<t.length;s++)i=this.removeMarker_(t[s]),r=r||i;return!e&&r&&this.repaint(),r}removeMarker_(t){var e,s=-1;if(this.markers_.indexOf)s=this.markers_.indexOf(t);else for(e=0;e<this.markers_.length;e++)if(t===this.markers_[e]){s=e;break}return-1!==s&&(t.setMap(null),this.markers_.splice(s,1),!0)}clearMarkers(){this.resetViewport_(!0),this.markers_=[]}repaint(){var t=this.clusters_.slice();this.clusters_=[],this.resetViewport_(!1),this.redraw_(),setTimeout((function(){var e;for(e=0;e<t.length;e++)t[e].remove()}),0)}getExtendedBounds(t){var e=this.getProjection(),s=new google.maps.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()),i=new google.maps.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()),r=e.fromLatLngToDivPixel(s);r.x+=this.gridSize_,r.y-=this.gridSize_;var a=e.fromLatLngToDivPixel(i);a.x-=this.gridSize_,a.y+=this.gridSize_;var n=e.fromDivPixelToLatLng(r),h=e.fromDivPixelToLatLng(a);return t.extend(n),t.extend(h),t}redraw_(){this.createClusters_(0)}resetViewport_(t){var e,s;for(e=0;e<this.clusters_.length;e++)this.clusters_[e].remove();for(this.clusters_=[],e=0;e<this.markers_.length;e++)(s=this.markers_[e]).isAdded=!1,t&&s.setMap(null)}distanceBetweenPoints_(t,e){var s=(e.lat()-t.lat())*Math.PI/180,i=(e.lng()-t.lng())*Math.PI/180,r=Math.sin(s/2)*Math.sin(s/2)+Math.cos(t.lat()*Math.PI/180)*Math.cos(e.lat()*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}isMarkerInBounds_(t,e){return e.contains(t.getPosition())}addToClosestCluster_(t){var s,i,r,a,n=4e4,h=null;for(s=0;s<this.clusters_.length;s++)(a=(r=this.clusters_[s]).getCenter())&&(i=this.distanceBetweenPoints_(a,t.getPosition()))<n&&(n=i,h=r);h&&h.isMarkerInClusterBounds(t)?h.addMarker(t):((r=new e(this)).addMarker(t),this.clusters_.push(r))}createClusters_(t){var e,s,i,r=this;if(this.ready_){0===t&&(google.maps.event.trigger(this,"clusteringbegin",this),void 0!==this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic)),i=this.getMap().getZoom()>3?new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625));var a=this.getExtendedBounds(i),n=Math.min(t+this.batchSize_,this.markers_.length);for(e=t;e<n;e++)!(s=this.markers_[e]).isAdded&&this.isMarkerInBounds_(s,a)&&(!this.ignoreHidden_||this.ignoreHidden_&&s.getVisible())&&this.addToClosestCluster_(s);n<this.markers_.length?this.timerRefStatic=setTimeout((function(){r.createClusters_(n)}),0):(delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this))}}extend(t,e){return function(t){var e;for(e in t.prototype)this.prototype[e]=t.prototype[e];return this}.apply(t,[e])}CALCULATOR(t,e){for(var s=0,i=t.length.toString(),r=i;0!==r;)r=parseInt(r/10,10),s++;return{text:i,index:s=Math.min(s,e),title:""}}}return s}();
